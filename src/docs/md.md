# 关于个人对单元测试思考的相关报告
## 写在前面
从一开始就一直在纠结，要不要写单测。从网格站到小程序，再到基础物料，对于要不要写单测算是有一个比较清晰明了的答案了。

- 先说说为什么要写测试
    - 提供描述组件行为的文档
    - 节省手动测试的时间
    - 减少研发新特性时产生的 bug
    - 改进设计：当会对一个组件写测试时，你会对这个组件一定会有一个全面且比较清晰的了解的。那你也一定会感知到这个组件里设计不合理的地方，做为一个当代四好青年，对于这种地方，你一定是有强烈的欲望去改进的。
    - 促进重构：这个点，我有些个人的感受。我是真想重构，想直面祖传代码，但是，我一点信心都没有。

> 我认为，代码是有保质期的，随着时间的推移，代码是会腐化的，特别是业务代码。比如，一开始，第一批开发者，代码设计的非常完美，各个方面都很合理。但是，也许后面业务场景有变更，维护者有变更，会让之前的设计从合理完美变得不合理，但是，后来的维护者一般又不怎么敢大刀阔斧的改前人留下的代码，就基于老代码，加上自己的新代码，甚至新开一个逻辑分支做，这就会让代码越来越不可理解，越来越不合理，越来越臃肿。直到维护不动了，就只能硬着头皮重构或从头开始重写（总会有一个幸运儿遇到的）。我个人认为，保持代码的新鲜度只能是时时重构，重构并不是重写，从小处重构，比如全局功能函数有没有可以优化或精减的地方，业务调整时，涉及的代码是否可以删除无用代码，不要想着留下以后再复用，组件是否可以根据当前的业务场景重新调整。看到有问题的，不好理解的，也想想是不是可以调整调整。这样，就不会使得项目变得无法维护，至少会让腐败速度变慢。但是为什么大部分项目最后都变得不好维护呢，因为，大家往往不敢动老代码，为什么不敢动？因为没有心里没底，如果有单测，那情况就完全不一样。核心代码，底层逻辑都有单测保证，那就能放心的改了，就不会畏首畏尾了。


## 个人理解  
- 哪些代码需要写？  
    个人认为，所有运行的代码都需要写，只是需要权衡得到优先级。比如 公共工具、公共组件、业务组件、业务页面。
    
- 怎么写？  
    我们团队主要是vue，针对vue项目，官方是有单元测试库的，[Vue Test Utils](https://vue-test-utils.vuejs.org/zh/)。用这个库配合[jest](https://jestjs.io/)，我们很容易就能写单元测试。并且，具体的写法，我们可以参考[Vue测试指南](https://lmiller1990.github.io/vue-testing-handbook/zh-CN/#%E8%BF%99%E6%9C%AC%E6%8C%87%E5%8D%97%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F)，这个文档里，对于单元测试写的超级详细，超级直白。

- 测试用例写到什么程序？
    这个问题的答案，应该是基于几个原则之后针对特定项目写特定用例。有哪些原则呢？
    - 只考虑测试，不考虑内部实现。比如，当我知道一个函数内部的具体实现，我们在写测试用例时，不需要为了‘迎合’内部实现而写用例。只需要关心输入与输出。
    - 测试数据，尽量模拟实际场景，越贴近现实场景越好。比如，到酒吧里要蛋炒饭的场景，其实不用写测试用例。
    - 多思考一些边界条件，比如，酒吧里没有杯子了，没有桌子了。
    - 尽量是边开发边写测试，避免之后补测试。
    
 
## 写在后面    
个人平时是有想写单元测试的念头的。但是，往往会与倒逼的工期产生矛盾，不单单是开发的时候没有时间写测试，后续也没有时间补测试。但是我想，我们团队的基础物料、核心项目、项目里的核心代码等还是要抽时间写测试。
